!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("cheerio")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("request-promise")},function(e,t){e.exports=require("js-yaml")},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(2),i=r(0),o=r(4),u=r(12),s=r(20),c=r(3);t.loadYamlConfig=function(e,t){return e||(e=u.resolve("config.yml")),o.existsSync(e)?new Promise(function(r,n){try{var a=c.safeLoad(o.readFileSync(e,"utf8"));if(t&&!a[t])throw new Error("Config with name '"+t+"' doesn't exist");return r(t?a[t]:a)}catch(e){n(e)}}):Promise.reject(new Error("Provied path ("+e+") does not exist!"))},t.loadUrl=function(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))return Promise.reject(new Error("URL must be start with either http:// or https://"));var t=e.toLowerCase();return a({uri:t,headers:{"User-Agent":"Request-Promise"},transform:function(e){return i.load(e)}}).then(function(e){return e("html")})},t.loadFile=function(e){return e?new Promise(function(t,r){var a;"string"==typeof e?o.readFile(e,function(e,n){if(e)return r(e);var a=i.load(n);return t(a("html"))}):(a=e)instanceof s.Readable&&n("function"===a._read)&&n("object"===a._readableState)?e.on("data",function(e){var r=i.load(e);t(r("html"))}):r(new Error("Filename was provided but invalid"))}):Promise.reject(new Error("Filename is required"))},t.loadHTML=function(e){if(!e)return Promise.reject(new Error("HTML argument is required and it should not be empty"));var t=i.load(e);return Promise.resolve(t("html"))}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(){function e(t,r){var n=r.parent,a=void 0===n?void 0:n,i=r.required,o=void 0!==i&&i,u=r.max,s=void 0===u?-1:u,c=r.min,f=void 0===c?0:c,l=r.attrs,h=void 0===l?{}:l,p=r.childs,d=void 0===p?[]:p;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new Error("tagName is required");this._tagName=t,this.parent=a,this.required=o||!1,this.max=s||-1,this.min=f||0,this.attrs=h||{},this.childs=d||[]}return n(e,[{key:"tagName",get:function(){return this._tagName}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(8),a=n.SEOLinter,i=n.loadYamlConfig;e.exports={SEOLinter:a,loadYamlConfig:i}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(9),i=r(5),o=r(6);e.exports=n({SEOLinter:a,TagRule:o},i)},function(e,t,r){"use strict";var n,a=r(10),i=(n=a)&&n.__esModule?n:{default:n},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,i){try{var o=t[a](i),u=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var f=r(1),l=(r(0),r(4)),h=r(5),p=h.loadUrl,d=h.loadHTML,v=h.loadFile,m=r(6),g=r(13).ERROR_CODE,y=function(){function e(t){var r=t.rules;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!r)throw new Error("Rules is required!");if(!f.isObject(r))throw new Error("Rules must be an object!");this.errors=[],this.tags=[],this.initRules(r)}return u(e,[{key:"initRules",value:function(e){var t=this;this.rulesMap={},this.tags=Object.keys(e),this.tags.forEach(function(e){t.rulesMap[e]={rules:[]}}),this.tags.forEach(function(r){var n=e[r],a=f.isArray(n)?t.createTagRules(r,n):[t.createTagRule(r,n)];t.rulesMap[r].rules=[].concat(c(t.rulesMap[r].rules),c(a))})}},{key:"createTagRule",value:function(e,t,r){return e||(t=t[e=Object.keys(t)[0]]),new m(e,o({},t,{parent:r}))}},{key:"createTagRules",value:function(e,t){var r=this;return t.map(function(t){return r.createTagRule(e,t)})}},{key:"assignElement",value:function(e){var t=this;this.tags.forEach(function(r){t.rulesMap[r].$=e.find(r)})}},{key:"createError",value:function(e,t,r){return{code:t,message:r,tagName:e.tagName}}},{key:"validate",value:function(e){var t=this,r=this.rulesMap[e],n=r.rules,a=r.$;return n.reduce(function(e,r){return e.concat(t.validateRule({rule:r,$:a}))},[])}},{key:"validateRule",value:function(e){var t=this,r=e.rule,n=e.$,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=r.tagName,o=r.required,u=r.max,s=r.min,c=r.attrs,l=(r.childs,r.parent);l&&(n=n.find(i));var h=n.length;if("head"===i&&""===n.html().trim()&&(h=0),o&&0===h){var p=l?"<"+l+"> tag":"HTML document";return a.push(this.createError(r,g.ERR_TAG_NOT_FOUND,p+" required <"+i+"> tag but it doesn't exist")),a}if(-1!==u&&h>u&&a.push(this.createError(r,g.ERR_TAG_MAX_EXCEED,"The maximum element of <"+i+"> tag is "+u+" but this HTML document has "+h+" <"+i+"> tags.")),0!==s&&h<s&&a.push(this.createError(r,g.ERR_TAG_MIN_UNDER,"The minimum element of <"+i+"> tag is "+s+" but this HTML document has "+h+" <"+i+"> tags.")),!f.isEmpty(c)){var d=this.validateAttrs(r,n);a=a.concat(d)}return r.childs.length>0&&(a=r.childs.reduce(function(e,i){return e.concat(t.validateRule({rule:t.createTagRule(null,i,r.tagName),$:n},a))},[])),a}},{key:"validateAttrs",value:function(e,t){var r=this,n=e.attrs,a=e.parent,i=t.length,o=Object.keys(n),u={},s=[];return 0===i?o.map(function(t){return r.createError(e,g.ERR_TAG_NOT_FOUND,"<"+e.tagName+" "+t+"='"+(n[t].value||"")+"'> was not found in "+(a?"<"+a+"> tag":"HTML document"))}):(t.each(function(e,t){o.forEach(function(e){var r=n[e].value;u.hasOwnProperty(e)||(u[e]={present:0,matched:0});var a=t.attribs[e];a&&(u[e].present+=1,a==r&&r&&(u[e].matched+=1))})}),o.forEach(function(t){var o=u[t],c=o.present,f=o.matched,l=n[t];if(l.required){var h=i-c;h>0&&s.push(r.createError(e,g.ERR_ATTR_NOT_FOUND,"There are "+h+" <"+e.tagName+"> tags without ["+t+"] attribute"))}if(l.value){var p=i-f;if(p>0&&p<i&&!l.min){var d="There are "+i+" <"+e.tagName+"> tags but there are "+p+" tags have no attribute ["+t+"='"+l.value+"'].";s.push(r.createError(e,g.ERR_ATTR_NOT_EQUAL,d))}f<(l.min||0)&&s.push(r.createError(e,g.ERR_ATTR_NOT_EQUAL,"At least "+l.min+" <"+e.tagName+"> tags must have attribute ["+t+"='"+l.value+"']. Need more "+(l.min-f)+" <"+e.tagName+" "+t+"='"+l.value+"'> tags.")),p===i&&s.push(r.createError(e,g.ERR_ATTR_NOT_EQUAL,(a?"<"+a+"> tag":"HTML")+" required <"+e.tagName+"> tag present with attribute ["+t+"='"+l.value+"'] but no one is valid"))}}),s)}},{key:"lint",value:function(){var e=s(i.default.mark(function e(t){var r,n=this,a=t.uri,o=t.html,u=t.file,s=t.rules,c=t.output,f=void 0===c?{type:"console",silence:!1}:c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a||o||u){e.next=2;break}throw new Error("You must provide either uri, html, file or readable stream for linting.");case 2:if(s&&this.initRules(s),r=void 0,!a){e.next=10;break}return e.next=7,p(a);case 7:r=e.sent,e.next=20;break;case 10:if(!o){e.next=16;break}return e.next=13,d(o);case 13:r=e.sent,e.next=20;break;case 16:if(!u){e.next=20;break}return e.next=19,v(u);case 19:r=e.sent;case 20:if(this.assignElement(r),this.errors=this.tags.reduce(function(e,t){return e.concat(n.validate(t))},[]),0!==this.errors.length){e.next=24;break}return e.abrupt("return",this.errors);case 24:return e.abrupt("return",this.writeOut(f));case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeOut",value:function(){var e=s(i.default.mark(function e(t){var r,n,a,o,u=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=13;break}if(r=t.type,n=t.silence,a=null,-1!==["console","file"].indexOf(r)){e.next=5;break}throw new Error("Output type ["+r+"] is not valid. Accepted output are [console, file]");case 5:if("console"!==r){e.next=8;break}return n||this.printErrors(),e.abrupt("return",this.errors);case 8:if("file"!==r||t.path){e.next=10;break}throw new Error("Provied path must be correct and existed");case 10:return a="string"==typeof t.path?l.createWriteStream(t.path):t.path,o=this.toOutputString(),e.abrupt("return",new Promise(function(e,t){a.once("open",function(){a.write(new Buffer(o,"utf8")),a.end()}),a.on("finish",function(){e(u.errors)})}));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"toOutputString",value:function(){var e="",t=0;return this.errors.forEach(function(r){var n=r.code,a=r.message;e+="["+ ++t+"]["+n+"] "+a+"\n"}),e}},{key:"printErrors",value:function(){console.log(this.toOutputString())}}]),e}();e.exports=y},function(e,t,r){e.exports=r(11)},function(e,t){e.exports=require("regenerator-runtime")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";t.ERROR_CODE={ERR_TAG_NOT_FOUND:"TAG001",ERR_TAG_MAX_EXCEED:"TAG002",ERR_TAG_MIN_UNDER:"TAG003",ERR_ATTR_NOT_FOUND:"ATTR001",ERR_ATTR_NOT_EQUAL:"ATTR002"}},,,,,,,function(e,t){e.exports=require("stream")}])});
//# sourceMappingURL=index.js.map