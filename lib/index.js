!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("cheerio")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("request-promise")},function(e,t){e.exports=require("js-yaml")},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";var n=r(2),i=r(0),a=r(4),o=r(12),u=r(3);t.loadYamlConfig=function(e,t){return e||(e=o.resolve("config.yml")),a.existsSync(e)?new Promise(function(r,n){try{var i=u.safeLoad(a.readFileSync(e,"utf8"));return r(t?i[t]:i)}catch(e){n(e)}}):Promise.reject(new Error("Provied path ("+e+") does not exist!"))},t.loadUrl=function(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))return Promise.reject(new Error("URL must be start with either http:// or https://"));var t=e.toLowerCase();return n({uri:t,headers:{"User-Agent":"Request-Promise"},transform:function(e){return i.load(e)}}).then(function(e){return e("html")})},t.loadFile=function(e){return e?a.existsSync(e)?new Promise(function(t,r){a.readFile(e,function(e,n){if(e)return r(e);var a=i.load(n);return t(a("html"))})}):Promise.reject(new Error("Path provied <"+e+"> does not exist")):Promise.reject(new Error("Filename is required"))},t.loadHTML=function(e){if(!e)return Promise.reject(new Error("HTML argument is required and it should not be empty"));var t=i.load(e);return Promise.resolve(t("html"))}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(){function e(t,r){var n=r.parent,i=void 0===n?void 0:n,a=r.required,o=void 0!==a&&a,u=r.max,s=void 0===u?-1:u,c=r.min,f=void 0===c?0:c,l=r.attrs,h=void 0===l?{}:l,p=r.childs,d=void 0===p?[]:p;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new Error("tagName is required");this._tagName=t,this.parent=i,this.required=o||!1,this.max=s||-1,this.min=f||0,this.attrs=h||{},this.childs=d||[]}return n(e,[{key:"tagName",get:function(){return this._tagName}}]),e}();e.exports=i},function(e,t,r){"use strict";var n=r(8),i=n.SEOLinter,a=n.loadYamlConfig;e.exports={SEOLinter:i,loadYamlConfig:a}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=r(9),a=r(5),o=r(6);e.exports=n({SEOLinter:i,TagRule:o},a)},function(e,t,r){"use strict";var n,i=r(10),a=(n=i)&&n.__esModule?n:{default:n},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,a){try{var o=t[i](a),u=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var f=r(1),l=(r(0),r(4)),h=r(5),p=h.loadUrl,d=h.loadHTML,v=h.loadFile,m=r(6),g=r(13).ERROR_CODE,E=function(){function e(t){var r=t.rules;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!r)throw new Error("Rules is required!");if(!f.isObject(r))throw new Error("Rules must be an object!");this.errors=[],this.tags=[],this.initRules(r)}return u(e,[{key:"initRules",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.rulesMap={},this.tags=Object.keys(t),this.tags.forEach(function(r){var n=t[r],i=f.isArray(n)?e.createTagRules(r,n):[e.createTagRule(r,n)];e.rulesMap.hasOwnProperty(r)?e.rulesMap[r].rules=[].concat(c(e.rulesMap[r].rules),c(i)):e.rulesMap[r]={rules:i}})}},{key:"createTagRule",value:function(e,t,r){if(!e){if(f.isEmpty(t))throw new Error("Configuration is invalid");t=t[e=Object.keys(t)[0]]}return new m(e,o({},t,{parent:r}))}},{key:"createTagRules",value:function(e,t){var r=this;return t.map(function(t){return r.createTagRule(e,t)})}},{key:"assignElement",value:function(e){var t=this;this.tags.forEach(function(r){t.rulesMap[r].$=e.find(r)})}},{key:"createError",value:function(e,t,r){return{code:t,message:r||"Error from <"+e.tagName+">",tagName:e.tagName}}},{key:"validate",value:function(e){var t=this,r=this.rulesMap[e],n=r.rules,i=r.$;return n.reduce(function(e,r){return e.concat(t.validateRule({rule:r,$:i}))},[])}},{key:"validateRule",value:function(e){var t=this,r=e.rule,n=e.$,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=r.tagName,o=r.required,u=r.max,s=r.min,c=r.attrs,l=(r.childs,r.parent);l&&(n=n.find(a));var h=n.length;if("head"===a&&""===n.html().trim()&&(h=0),o&&0===h){var p=l?"<"+l+"> tag":"HTML document";return i.push(this.createError(r,g.ERR_TAG_NOT_FOUND,p+" required <"+a+"> tag but it doesn't exist")),i}if(-1!==u&&h>u&&i.push(this.createError(r,g.ERR_TAG_MAX_EXCEED,"The maximum element of <"+a+"> tag is "+u+" but this HTML document has "+h+" <"+a+"> tags.")),0!==s&&h<s&&i.push(this.createError(r,g.ERR_TAG_MIN_UNDER,"The minimum element of <"+a+"> tag is "+s+" but this HTML document has "+h+" <"+a+"> tags.")),!f.isEmpty(c)){var d=this.validateAttrs(r,n);i=i.concat(d)}return r.childs.length>0&&(i=r.childs.reduce(function(e,a){return e.concat(t.validateRule({rule:t.createTagRule(null,a,r.tagName),$:n},i))},[])),i}},{key:"validateAttrs",value:function(e,t){var r=this,n=e.attrs,i=e.parent,a=t.length,o=Object.keys(n),u={},s=[];return 0===a?o.map(function(t){return r.createError(e,g.ERR_TAG_NOT_FOUND,"<"+e.tagName+" "+t+"='"+(n[t].value||"")+"'> was not found in "+(i?"<"+i+"> tag":"HTML document"))}):(t.each(function(e,t){o.forEach(function(e){var r=n[e].value;u.hasOwnProperty(e)||(u[e]={present:0,matched:0});var i=t.attribs[e];i&&(u[e].present+=1,i==r&&r&&(u[e].matched+=1))})}),o.forEach(function(t){var o=u[t],c=o.present,f=o.matched,l=n[t];if(l.required){var h=a-c;h>0&&s.push(r.createError(e,g.ERR_ATTR_NOT_FOUND,"There are "+h+" <"+e.tagName+"> tags without ["+t+"] attribute"))}if(l.value){var p=a-f;if(p>0&&p<a&&!l.min){var d="There are "+a+" <"+e.tagName+"> tags but there are "+p+" tags have no attribute ["+t+"='"+l.value+"'].";s.push(r.createError(e,g.ERR_ATTR_NOT_EQUAL,d))}f<(l.min||0)&&s.push(r.createError(e,g.ERR_ATTR_NOT_EQUAL,"At least "+l.min+" <"+e.tagName+"> tags must have attribute ["+t+"='"+l.value+"']. Need more "+(l.min-f)+" <"+e.tagName+" "+t+"='"+l.value+"'> tags.")),p===a&&s.push(r.createError(e,g.ERR_ATTR_NOT_EQUAL,(i?"<"+i+"> tag":"HTML")+" required <"+e.tagName+"> tag present with attribute ["+t+"='"+l.value+"'] but no one is valid"))}}),s)}},{key:"lint",value:function(){var e=s(a.default.mark(function e(t){var r,n=this,i=t.uri,o=t.html,u=t.file,s=t.rules,c=t.output,f=void 0===c?{type:"console",silence:!1}:c;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i||o||u){e.next=2;break}throw new Error("You must provide either uri, html, file or readable stream for linting.");case 2:if(s&&this.initRules(s),r=void 0,!i){e.next=10;break}return e.next=7,p(i);case 7:r=e.sent,e.next=20;break;case 10:if(!o){e.next=16;break}return e.next=13,d(o);case 13:r=e.sent,e.next=20;break;case 16:if(!u){e.next=20;break}return e.next=19,v(u);case 19:r=e.sent;case 20:if(this.assignElement(r),this.errors=this.tags.reduce(function(e,t){return e.concat(n.validate(t))},[]),0!==this.errors.length){e.next=24;break}return e.abrupt("return",this.errors);case 24:return e.abrupt("return",this.writeOut(f));case 25:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"writeOut",value:function(){var e=s(a.default.mark(function e(t){var r,n,i,o,u=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=13;break}if(r=t.type,n=t.silence,i=null,-1!==["console","file"].indexOf(r)){e.next=5;break}throw new Error("Output type ["+r+"] is not valid. Accepted output are [console, file]");case 5:if("console"!==r){e.next=8;break}return n||this.printErrors(),e.abrupt("return",this.errors);case 8:if("file"!==r||t.path){e.next=10;break}throw new Error("Provied path must be correct and existed");case 10:return i="string"==typeof t.path?l.createWriteStream(t.path):t.path,o=this.toOutputString(),e.abrupt("return",new Promise(function(e,t){i.once("open",function(){i.write(new Buffer(o,"utf8")),i.end()}),i.on("finish",function(){e(u.errors)})}));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"toOutputString",value:function(){var e="",t=0;return this.errors.forEach(function(r){var n=r.code,i=r.message;e+="["+ ++t+"]["+n+"] "+i+"\n"}),e}},{key:"printErrors",value:function(){console.log(this.toOutputString())}}]),e}();e.exports=E},function(e,t,r){e.exports=r(11)},function(e,t){e.exports=require("regenerator-runtime")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";t.ERROR_CODE={ERR_TAG_NOT_FOUND:"TAG001",ERR_TAG_MAX_EXCEED:"TAG002",ERR_TAG_MIN_UNDER:"TAG003",ERR_ATTR_NOT_FOUND:"ATTR001",ERR_ATTR_NOT_EQUAL:"ATTR002"}}])});
//# sourceMappingURL=index.js.map